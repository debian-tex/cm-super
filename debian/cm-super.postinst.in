#include variables
#!/bin/sh -e

create_fontmaps ()
{
    tempfile=`mktemp -p /tmp cm-super.updmap.XXXXXXXX`
    echo -n "Running updmap<:=$SYSEXTENSION:>. This may take some time. ..."
    if updmap<:=$SYSEXTENSION:> > $tempfile 2>&1 ; then
      rm -f $tempfile
      echo " done."
    else
      echo
      echo "updmap<:=$SYSEXTENSION:> failed. Output has been stored in"
      echo "$tempfile"
      echo "Please include this file if you report a bug."
      echo
      exit 1
    fi
}

update_lsr_files ()
{
    tempfile=`mktemp -p /tmp cm-super.mktexlsr.XXXXXXXX`
    echo -n "Running mktexlsr. This may take some time. ..."
    if mktexlsr /usr/share/texmf > $tempfile 2>&1 ; then
         rm -f $tempfile
         echo " done."
    else
         echo
         echo "mktexlsr failed. Output has been stored in"
         echo "$tempfile"
         echo "Please include this file if you report a bug."
         echo
         exit 1
    fi
}


# Extract the .pfb files

case "$1" in
    configure)
    	cd /usr/share/texmf/fonts/type1/public/cm-super
	echo -n "Generating fonts. This may take some time. ..."
	if which t1c2pfb > /dev/null 2>&1 ; then
	    t1c2pfb <cm-super.t1c >/dev/null 2>&1
	else
	    export PERL_BADLANG=x
	    perl -x /usr/bin/t1c2pfb.pl <cm-super.t1c >/dev/null 2>&1
	fi
	echo " done."
	update-updmap
	update_lsr_files
	create_fontmaps
    ;;

    abort-upgrade|abort-remove|abort-deconfigure)
	update-updmap
	update_lsr_files
	create_fontmaps
    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac


#DEBHELPER#

exit 0
